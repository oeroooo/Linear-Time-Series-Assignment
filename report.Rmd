---
title: Linear Time Series Assignment
subtitle: 
date: 2023-2024
author: 
 - Romain Delhommais
 - Jacques Zhang
editor: ENSAE
output: 
  pdf_document
---

```{knitr setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, warning = FALSE, message = FALSE, fig.width=8, fig.height=6, fig.align='center')
```

```{r}
library(dplyr)
library(kableExtra)
library(astsa)
library(forecast)
library(portes)
library(fUnitRoots)
library(tseries)
```


# The data 
## The studied temporal series
```{r}
Time_series <- read.csv("data/valeurs_mensuelles.csv", sep = ";") %>%  
  filter(!row_number() %in% c(1, 2, 3)) 

names(Time_series) <- c("date", "value", "codes")
Time_series$date <- as.Date(paste(Time_series$date, "-01", sep=""))
Time_series$value <- as.numeric(Time_series$value)


caracteristiques <- read.csv("data/caractéristiques.csv", sep = ";")
```
In this project, we will study the monthly series of the fabrication of french weapons and ammo from 1990 to 2024. This series is accessible 
in the INSEE website https://www.insee.fr/fr/statistiques/serie/010767975.
The initial series is ploted on the following graph:

```{r}
plotly::plot_ly(x = Time_series$date, y = Time_series$value, type = "scatter", mode = "lines") %>%
  plotly::layout(title = "Monthly series of the fabrication of french weapons and ammo from 1990 to 2024",
                 xaxis = list(title = "Date"),
                 yaxis = list(title = "Value"))
```
We see that the series is not stationary, the series might present seasonality or trend. 
```{r}
acf(Time_series$value)
pacf(Time_series$value)
```

## Transformation of the series 
We will use the log return of the series to make it stationary. 
```{r}
log_return <- c(diff(log(Time_series$value)))
```
We will plot the log return of the series to check if it is stationary.
```{r}
plotly::plot_ly(x = Time_series$date, y = Time_series$log_return, type = "scatter", mode = "lines") %>%
  plotly::layout(title = "Log return of the series",
                 xaxis = list(title = "Date"),
                 yaxis = list(title = "Value"))
```
The log return of the series seems to be stationary.
```{r}
acf(log_return)
pacf(log_return)
```

We will test the stationarity of the series using the Augmented Dickey-Fuller test, the Phillips-Perron test and the KPSS stationnarity test.
```{r}
adfTest(log_return)
pp.test(log_return)
kpss.test(log_return)
```


## Representation of the series before and after transformation

```{r}
plotly::subplot(
  plotly::plot_ly(x = Time_series$date, y = Time_series$value, type = "scatter", mode = "lines") %>%
    plotly::layout(title = "Initial series",
                   xaxis = list(title = "Date"),
                   yaxis = list(title = "Value")),
  plotly::plot_ly(x = Time_series$date[-1], y = log_return, type = "scatter", mode = "lines") %>%
    plotly::layout(title = "Log return of the series",
                   xaxis = list(title = "Date"),
                   yaxis = list(title = "Value"))
)

```

# ARMA models
## Selection of the arma model
We see that the tests of the stationarity consider a maximum lag of 5. Hence we will select our p and q parameters in the ARMA model between 0 and 6. 
## AIC and BIC criteria

## Validation of the model
# Prediction
## Confidence region of level α
## Hypothesis
## Graphic representation
## Open question